# API設計

## 1. ユーザー

### 1-1. ユーザーを登録する

- **エンドポイント:** `/users`
- **メソッド:** POST
- **説明:** 新規ユーザーを登録します。
- **リクエストヘッダ:**
  - Content-Type: application/json (必須)
- **リクエストボディ:**

  ```json
  {
    "user": {
      "username": "ユーザー名",
      "password": "パスワード",
      "password_confirmation": "パスワード(確認)"
    }
  }
  ```

- **ステータスコード:** `201 Created`
- **レスポンスボディ:**
  
  ```json
  {
    "user": {
      "id": "ユーザーID",
      "username": "ユーザー名"
    }
  }
  ```

### 1-2. ログインする(トークンを発行する)

- **エンドポイント:** `/users/login`
- **メソッド:** POST
- **説明:** 正しいユーザー名とパスワードであればトークンを返します。
- **リクエストヘッダ:**
  - Content-Type: application/json (必須)
- **リクエストボディ:**

  ```json
  {
    "user": {
      "username": "ユーザー名",
      "password": "パスワード"
    }
  }
  ```

- **ステータスコード:** `200 OK`
- **レスポンスボディ:**
  
  ```json
  {
    "user": {
      "id": "ユーザーID",
      "username": "ユーザー名",
      "token": "トークン"
    }
  }
  ```

## 2. 聖地

### 2-1. 聖地を新規登録する

- **エンドポイント:** `/meccas`
- **メソッド:** POST
- **説明:** 聖地を新規登録します。
  - ユーザー認証が必要です。
  - 登録後は新規登録した聖地のページに飛ぶと思うので、レスポンスでは聖地情報を一通り返します。
  - 聖地写真の格納方法は要確認。
- **リクエストヘッダ:**
  - Content-Type: application/json (必須)
  - Authorization: Bearer <トークン> (必須)
- **リクエストボディ:**

  ```json
  {
    "mecca": {
      "anime_id": "アニメID",
      "title": "タイトル",
      "episode": "エピソード",
      "scene": "シーンの秒数",
      "mecca_name": "聖地名",
      "about": "聖地の説明",
      "place_id":"場所ID",
      "prefecture": "都道府県名",
      "photos": ["画像のパス1", "画像のパス2", "画像のパス3"]
    }
  }
  ```

- **ステータスコード:** `201 Created`
- **レスポンスボディ:**
  
  ```json
  {
    "mecca": {
      "mecca_id": "聖地ID",
      "anime_id": "アニメID",
      "title": "タイトル",
      "episode": "エピソード",
      "scene": "シーンの秒数",
      "mecca_name": "聖地名",
      "about": "聖地の説明",
      "place_id":"場所ID",
      "prefecture": "都道府県名",
      "photos": ["画像のパス1", "画像のパス2", "画像のパス3"],
      "username": "登録者名"
    }
  }
  ```

### 2-2. 聖地一覧(都道府県ごと)を取得する

- **エンドポイント:** `/meccas/prefecture/:prefecture`
- **メソッド:** GET
- **説明:** 都道府県名から聖地の一覧を取得します。
  - ユーザー認証は不要です。
  - 認証ユーザーであれば、お気に入り登録のマークを表示します。
- **パスパラメータ:**
  - prefecture
- **リクエストヘッダ:**
  - Authorization: Bearer <トークン>
- **ステータスコード:** `200 OK`
- **レスポンスボディ:**
  
  ```json
  {
    "meccas": [
      {
        "mecca_id": "聖地ID",
        "anime_id": "アニメID",
        "title": "タイトル",
        "episode": "エピソード",
        "scene": "シーンの秒数",
        "mecca_name": "聖地名",
        "about": "聖地の説明",
        "place_id":"場所ID",
        "prefecture": "都道府県名",
        "photos": ["画像のパス1", "画像のパス2", "画像のパス3"],
        "username": "登録者名",
        "is_favorite": "お気に入り登録しているか"
      },
      {
        ...
      }
    ]
  }
  ```

### 2-3. 特定の聖地を取得する

- **エンドポイント:** `/meccas/:id`
- **メソッド:** GET
- **説明:** 特定の聖地の詳細を取得します。
  - ユーザー認証は不要です。
  - 認証ユーザーであれば、お気に入り登録のマークを表示します。
  - その聖地を登録したユーザーであれば、編集削除ボタンを表示します。
- **パスパラメータ:**
  - id
- **リクエストヘッダ:**
  - Authorization: Bearer <トークン>
- **ステータスコード:** `200 OK`
- **レスポンスボディ:**
  
  ```json
  {
    "mecca": {
      "mecca_id": "聖地ID",
      "anime_id": "アニメID",
      "title": "タイトル",
      "episode": "エピソード",
      "scene": "シーンの秒数",
      "mecca_name": "聖地名",
      "about": "聖地の説明",
      "place_id":"場所ID",
      "prefecture": "都道府県名",
      "photos": ["画像のパス1", "画像のパス2", "画像のパス3"],
      "username": "登録者名",
      "is_author": "登録者かどうか",
      "is_favorite": "お気に入り登録しているかどうか"
    }
  }
  ```

### 2-4. 聖地を編集する

- **エンドポイント:** `/meccas/:id`
- **メソッド:** PUT
- **説明:** 聖地を編集します。
  - ユーザー認証が必要です。
  - 登録者本人だけが編集できます。
  - 編集後は編集した聖地のページに飛ぶと思うので、レスポンスでは聖地情報を一通り返します。
- **パスパラメータ:**
  - id
- **リクエストヘッダ:**
  - Content-Type: application/json (必須)
  - Authorization: Bearer <トークン> (必須)
- **リクエストボディ:**
  例: 聖地名の編集

  ```json
  {
    "mecca": {
      "mecca_name": "編集した聖地名"
    }
  }
  ```

- **ステータスコード:** `200 OK`
- **レスポンスボディ:**
  
  ```json
  {
    "mecca": {
      "mecca_id": "聖地ID",
      "anime_id": "アニメID",
      "title": "タイトル",
      "episode": "エピソード",
      "scene": "シーンの秒数",
      "mecca_name": "編集した聖地名",
      "about": "聖地の説明",
      "place_id":"場所ID",
      "prefecture": "都道府県名",
      "photos": ["画像のパス1", "画像のパス2", "画像のパス3"],
      "username": "登録者名"
    }
  }
  ```

### 2-5. 聖地を削除する

- **エンドポイント:** `/meccas/:id`
- **メソッド:** DELETE
- **説明:** 聖地を削除します。
  - ユーザー認証が必要です。
  - 登録者本人だけが削除できます。
- **パスパラメータ:**
  - id
- **リクエストヘッダ:**
  - Authorization: Bearer <トークン> (必須)

- **ステータスコード:** `204 No Content`

## 3. お気に入り

### 3-1. お気に入り登録する

- **エンドポイント:** `/meccas/:id/favorite`
- **メソッド:** POST
- **説明:** トークンからユーザーを特定し、そのユーザーのお気に入りに聖地を登録します。
- **パスパラメータ:**
  - id
- **リクエストヘッダ:**
  - Authorization: Bearer <トークン> (必須)
- **ステータスコード:** `204 No Content`

### 3-2. お気に入り解除する

- **エンドポイント:** `/meccas/:id/favorite`
- **メソッド:** DELETE
- **説明:** トークンからユーザーを特定し、そのユーザーのお気に入りから聖地を削除します。
- **パスパラメータ:**
  - id
- **リクエストヘッダ:**
  - Authorization: Bearer <トークン> (必須)
- **ステータスコード:** `204 No Content`

### 3-3. 特定のユーザーのお気に入り一覧を取得

- **エンドポイント:** `/favorites`
- **メソッド:** GET
- **説明:** トークンからユーザーを特定し、そのユーザーのお気に入り一覧を取得します。
- **リクエストヘッダ:**
  - Authorization: Bearer <トークン> (必須)
- **ステータスコード:** `200 OK`
- **レスポンスボディ:**
  
  ```json
  {
    "meccas": [
      {
        "mecca_id": "聖地ID",
        "anime_id": "アニメID",
        "title": "タイトル",
        "episode": "エピソード",
        "scene": "シーンの秒数",
        "mecca_name": "聖地名",
        "about": "聖地の説明",
        "place_id":"場所ID",
        "prefecture": "都道府県名",
        "photos": ["画像のパス1", "画像のパス2", "画像のパス3"],
        "username": "登録者名"
      },
      {
        ...
      }
    ]
  }
  ```
